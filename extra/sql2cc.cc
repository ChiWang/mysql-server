/*
   Copyright (c) 2012, 2014, Oracle and/or its affiliates. All rights reserved.

   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; version 2 of the License.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program; if not, write to the Free Software
   Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA
*/

#include <stdlib.h>
#include <iostream>
#include <fstream>
#include <sstream>
#include <string>
#include <algorithm>

using namespace std;

void find_and_replace(string& source, string const& find, string const& replace)
{
    for(unsigned i= 0;
        (i= source.find(find, i)) != string::npos;)
    {
        source.replace(i, find.length(), replace);
        i += replace.length() - find.length() + 1;
    }
}

int main(int argc, char *argv[])
{
  ifstream fin(argv[1]);
  stringstream sout;
  copy(istreambuf_iterator<char>(fin),
     istreambuf_iterator<char>(),
     ostreambuf_iterator<char>(sout));
  ofstream fout(argv[2]);
  fout << "/* This file is autogenerated */\n";
  string buff;
  fout << "std::string mysql_system_tables[]= {\n"
       << " \"CREATE DATABASE mysql;\\n\",\n"
       << " \"use mysql;\\n\",\n";
  while(!sout.eof())
  {
    getline(sout, buff, '\n');
    if (buff[0] != '-' && buff[0] != '\n' && buff[0] != '#' && buff.size() > 1)
    {
      find_and_replace(buff, "\"", "\\\"");
      cout << "\"" << buff << "\\n\",\n";
      fout << "\"" << buff << "\\n\",\n";
    } 
  }
  fout << "\"\"};\n";
  fout.flush();
  fout.close();
  exit(0);
}


