CREATE TABLE t1 (c1 INT NOT NULL PRIMARY KEY, c2 INT NOT NULL, c3 INT NOT NULL) ENGINE=InnoDB;
INSERT INTO t1 VALUES (0, 0, 0);

# On connection 1
START TRANSACTION;
UPDATE t1 SET c1=1, c2=1 WHERE c1=0 AND c2=0;

# On connection 2
START TRANSACTION;
UPDATE t1 SET c2=2 WHERE c3=0 AND c2=0;

# On connection 3
START TRANSACTION HIGH_PRIORITY;
UPDATE t1 SET c2=3 WHERE c2=0;
COMMIT;

# On connection 1
COMMIT;
ERROR HY000: Got error 149 during COMMIT

# On connection 2
COMMIT;
SELECT * FROM t1;
c1	0
c2	3
c3	0
DROP TABLE t1;
