set global innodb_file_per_table=on;
set global innodb_file_format='Barracuda';
drop table if exists t1;
# Verify that recovery works fine from a crash during
# the drop of the second secondary to a table with
# remote data directory and dynamic format.
create table t1(a int not null,
b int not null,
c int not null,
d blob not null,
primary key (a),
index (b),
index (c,d(120)))
row_format=dynamic engine=innodb data directory='mysql_tmp_dir/alt_dir';
select count(*) from t1;
count(*)
100
# Write file to make mysql-test-run.pl expect crash and restart
# Run the crashing query
truncate table t1;
ERROR HY000: Lost connection to MySQL server during query
# Restart the MySQL server
select count(*) from t1;
count(*)
0
select count(*) from t1;
count(*)
100
# Verify that 'TRUNCATE TABLE' statement can empty a table normally.
truncate table t1;
select count(*) from t1;
count(*)
0
# Verify that we can insert data into the truncated table normally.
select count(*) from t1;
count(*)
100
drop table t1;
