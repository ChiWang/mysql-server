#
# WL#7682: Optimize InnoDB temporary tables.
#

--source include/have_innodb.inc

################################################################################
#
# Workload will run following scenarios
# 1. Create/Drop sequence.
# 2. Basic DML operation on intrinsic table.
# 3. Run different types of queries on intrinsic table.
# 4. Multiple key DML
# 5. Large column (blob/text) column DML
#
################################################################################

#-----------------------------------------------------------------------------
#
# create test bed.
#
let $innodb_int = `select@@innodb_create_intrinsic`;

#-----------------------------------------------------------------------------
#
# Workload in non-read-only mode.
#
set session innodb_create_intrinsic = 1;
--source suite/innodb/include/innodb_wl7682_workload.inc

#-----------------------------------------------------------------------------
#
# Workload in read-only mode.
#
--echo "Restarting in read only mode"
--exec echo "wait" > $MYSQLTEST_VARDIR/tmp/mysqld.1.expect
--shutdown_server 60
--source include/wait_until_disconnected.inc
--enable_reconnect
--exec echo "restart: --innodb-read-only " > $MYSQLTEST_VARDIR/tmp/mysqld.1.expect
--enable_reconnect
--source include/wait_until_connected_again.inc
--disable_reconnect
#
#
set session innodb_create_intrinsic = 1;
--source suite/innodb/include/innodb_wl7682_workload.inc
#
#
--echo "Restarting Server in normal mode"
--exec echo "wait" > $MYSQLTEST_VARDIR/tmp/mysqld.1.expect
--shutdown_server 60
--source include/wait_until_disconnected.inc
--enable_reconnect
--exec echo "restart " > $MYSQLTEST_VARDIR/tmp/mysqld.1.expect
--enable_reconnect
--source include/wait_until_connected_again.inc
--disable_reconnect


#-----------------------------------------------------------------------------
#
# remove test bed.
#
eval set session innodb_create_intrinsic = $innodb_int;

