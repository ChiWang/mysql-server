include/master-slave.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the master info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START SLAVE; see the 'START SLAVE Syntax' in the MySQL Manual for more information.
Warnings:
Note	1753	slave_transaction_retries is not supported in multi-threaded slave mode. In the event of a transient failure, the slave will not retry the transaction and will stop.
[connection master]
CREATE TABLE IF NOT EXISTS t1 (a INT) ENGINE=InnoDB;
CREATE TABLE t2 (a INT) ENGINE=MyISAM;
INSERT INTO t1 VALUES(1);
INSERT INTO t2 VALUES(1);
#
# Verify that transactions' gtids can be reported
# from global.gtid_executed correctly.
#
include/assert.inc [committed gtids MASTER_UUID:1-4]
#
# Store gtids MASTER_UUID:1-4 in gtid_executed table on binlog rotation
#
FLUSH LOGS;
SELECT * FROM mysql.gtid_executed;
sid	gno_start	gno_end
MASTER_UUID	1	4
include/sync_slave_sql_with_master.inc
#
# connection slave
#
include/assert.inc [committed gtids MASTER_UUID:1-4]
#
# Verify that slave thread stores gtid into gtid_executed table within
# each transaction if binlog is on and log_slave_updated is disabled.
#
SELECT * FROM mysql.gtid_executed;
sid	gno_start	gno_end
MASTER_UUID	1	1
MASTER_UUID	2	2
MASTER_UUID	3	3
MASTER_UUID	4	4
INSERT INTO t1 VALUES(2);
INSERT INTO t2 VALUES(2);
#
# Verify that store gtids SLAVE_UUID:1-2 into gtid_executed table,
# which is also compressed on binlog rotation.
#
SET @debug_save= @@GLOBAL.DEBUG;
SET @@GLOBAL.DEBUG= '+d,compress_gtid_table';
FLUSH LOGS;
SET DEBUG_SYNC='now WAIT_FOR complete_compression';
SET GLOBAL DEBUG= @debug_save;
SELECT * FROM mysql.gtid_executed where sid="MASTER_UUID";
sid	gno_start	gno_end
MASTER_UUID	1	4
SELECT * FROM mysql.gtid_executed where sid="SLAVE_UUID";
sid	gno_start	gno_end
SLAVE_UUID	1	2
#
# Verify that we can get the correct set of gtid_purged when purging
# logs if binlog is enabled and log_slave_updates is disabled.
#
PURGE BINARY LOGS TO 'slave-bin.000002';
include/assert.inc [purged gtids SLAVE_UUID:1-2]
DROP TABLE t1,t2;
include/rpl_end.inc
