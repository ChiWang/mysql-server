include/master-slave.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the master.info repository is not secure and is therefore not recommended. Please see the MySQL Manual for more about this issue and possible alternatives.
[connection master]
call mtr.add_suppression("Error 'Table 'test.t' doesn't exist' on query.");
call mtr.add_suppression("The slave coordinator and worker threads are stopped, possibly leaving data in inconsistent state.*");

# Testing on fresh slave.

sql thread id extracted from SHOW PROCESSLIST and PS table match.
# Asserted this: SSS shows Slave_IO_Running as "Yes". So, Service_State from this PS table should be "On".
# Asserted this: Value returned by SSS and PS table for Last_Error_Number should be same.
# Asserted this: Value returned by SSS and PS table for Last_Error_Message should be same.
# Asserted this: Value returned by SSS and PS table for Last_Error_Timestamp should be 0000-00-00 00:00:00.
# Asserted this: SSS shows Slave_SQL_Running as "Yes". So, Service_State from this PS table should be "On".

# Cause an error in the SQL thread and check for the correctness of
# values in error number, message and timestamp fields.

use test;
create table t(a int primary key);
drop table t;
insert into t values(1);
include/wait_for_slave_sql_error.inc [errno=1146]

# Extract the error related fields from SSS and PS table and compare
# them for correctness.

# Asserted this: Value returned by SSS and PS table for Last_Error_Number should be same.
Value returned by SSS and PS table for Last_Error_Message is same.
# Asserted this: Value returned by SSS and PS table for Last_Error_Timestamp should be same.

# Verify that the error fields are preserved after STOP SLAVE, thread_id
# changes to NULL and service_state changes to "Off".


# 1. Verify that thread_id changes to NULL and service_state to "off" on
#    STOP SLAVE.

# Asserted this: After STOP SLAVE, thread_id should be NULL
# Asserted this: SSS shows Slave_SQL_Running as "No". So, Service_State from this PS table should be "Off".

# 2. Extract the error related fields from SSS and PS table and compare
#    them. These fields should preserve their values.

# Asserted this: Value returned by SSS and PS table for Last_Error_Number should be same.
Value returned by SSS and PS table for Last_Error_Message is same.
# Asserted this: Value returned by SSS and PS table for Last_Error_Timestamp should be same.
STOP SLAVE;
RESET SLAVE;
drop table t;
RESET MASTER;

# Restarting servers and setting up MTS now. Since, SQL thread and
# coordinator are the same and follow same code path, we can skip
# testing for coordinator thread in all scenarios. Testing for one
# scenario is enough.

include/rpl_restart_server.inc [server_number=1]
include/rpl_restart_server.inc [server_number=2]
change master to
master_host='127.0.0.1',
master_port=MASTER_MYPORT,
master_user='root';
Warnings:
Note	###	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	###	Storing MySQL user name or password information in the master.info repository is not secure and is therefore not recommended. Please see the MySQL Manual for more about this issue and possible alternatives.
SET @save.slave_parallel_workers=@@global.slave_parallel_workers;
SET @@global.slave_parallel_workers=1;
start slave;
Warnings:
Note	1753	slave_transaction_retries is not supported in multi-threaded slave mode. In the event of a transient failure, the slave will not retry the transaction and will stop.
coordinator's thread id extracted from SHOW PROCESSLIST and PS table match.
# Asserted this: SSS shows Slave_SQL_Running as "Yes". So, Service_State from this PS table should be "On".
# Asserted this: Value returned by SSS and PS table for Last_Error_Number should be same.
# Asserted this: Value returned by SSS and PS table for Last_Error_Message should be same.
# Asserted this: Value returned by SSS and PS table for Last_Error_Timestamp should be 0000-00-00 00:00:00.

# Cleanup.

include/stop_slave.inc
SET @save.slave_parallel_workers=@@global.slave_parallel_workers;
SET @@global.slave_parallel_workers=0;
include/start_slave.inc
include/rpl_end.inc
