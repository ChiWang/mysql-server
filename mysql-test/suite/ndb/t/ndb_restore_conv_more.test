-- source include/have_ndb.inc
-- source include/not_embedded.inc

--echo # bug#17275798
# use a canned backup with NULL char(10) log entries promoted to char(20)

create table t1 (
  a int unsigned primary key,
  b char(20),
  c int unsigned
) engine=ndb;

--echo # restore canned backup
--exec $NDB_RESTORE --no-defaults -b 1 -n 21 -r --promote-attributes $MYSQL_TEST_DIR/suite/ndb/backups/bug17275798 >> $NDB_TOOLS_OUTPUT

select sum(1),sum(isnull(b)),min(b),max(b) from t1;

drop table t1;

--echo # bug#17395298

create table t1 (
  a int primary key,
  b text,
  c int
) engine=ndb;

insert into t1 values (1,repeat('a',1000),10);
insert into t1 values (2,repeat('b',2000),20);
insert into t1 values (3,repeat('c',3000),30);

--echo # run backup
--source include/ndb_backup.inc

rename table t1 to t1old;

create table t1 (
  a int primary key,
  c int,
  b text
) engine=ndb;

--echo # run restore
--exec $NDB_RESTORE --no-defaults -b $the_backup_id -n 1 -r $NDB_BACKUPS-$the_backup_id >> $NDB_TOOLS_OUTPUT
--exec $NDB_RESTORE --no-defaults -b $the_backup_id -n 2 -r $NDB_BACKUPS-$the_backup_id >> $NDB_TOOLS_OUTPUT

select count(*) from t1 x, t1old y
where x.a = y.a and x.b = y.b and x.c = y.c;

drop table t1old;
drop table t1;
