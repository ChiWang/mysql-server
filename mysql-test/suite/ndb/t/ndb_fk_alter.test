-- source include/have_ndb.inc

###
### PK vs PK
###
create table parent (
  a int primary key auto_increment,
  b int not null,
  c int not null,
  unique(b) using hash,
  index(c)) engine = ndb;

create table child (
  a int primary key auto_increment,
  b int not null,
  c int not null,
  unique(b) using hash,
  index(c)) engine = ndb;

# Parent pk
# child pk, uk, oi
alter online table child add constraint fk1 foreign key (a) references parent(a);
alter online table child add constraint fk2 foreign key (b) references parent(a);
alter online table child add constraint fk3 foreign key (c) references parent(a);

show create table child;

alter online table child drop foreign key fk1;

show create table child;

alter online table child drop foreign key fk2;

show create table child;

alter online table child drop foreign key fk3;

show create table child;

drop table parent, child;

#
#
#
CREATE TABLE bug46599a (
	b VARCHAR(2), PRIMARY KEY(b)) ENGINE=ndb;

CREATE TABLE bug46599b (b VARCHAR(2),
       FOREIGN KEY (b) REFERENCES bug46599a (b)) ENGINE=Ndb;

INSERT INTO bug46599a VALUES ('b');
INSERT INTO bug46599b VALUES ('b'), (NULL);
--error ER_NO_REFERENCED_ROW_2
INSERT INTO bug46599b VALUES ('');

--sorted_result
SELECT * FROM bug46599a;
--sorted_result
SELECT * FROM bug46599b;

--error ER_FK_COLUMN_CANNOT_CHANGE
ALTER TABLE bug46599b MODIFY COLUMN b VARCHAR(2) NOT NULL DEFAULT '';

--sorted_result
SELECT * FROM bug46599b;

DROP TABLE bug46599b,bug46599a;
