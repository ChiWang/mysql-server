-- source include/have_ndb.inc

create database mydb0;
use mydb0;

create table parent (
  a int primary key,
  b int not null,
  c int not null,
  unique(b) using hash,
  index(c)) engine = ndb;

create database mydb1;
use mydb1;

create table child (
  a int primary key,
  b int not null,
  c int not null,
  constraint fk1 foreign key(a) references mydb0.parent (a),
  unique(b) using hash,
  index(c)) engine = ndb;

show create table child;

alter offline table child add constraint fk2 foreign key (b)
  references mydb0.parent(a);

show create table child;

alter online table child add constraint fk3 foreign key (c)
  references mydb0.parent(a);

show create table child;

alter offline table child drop foreign key fk2;

show create table child;

alter online table child drop foreign key fk3;

show create table child;

alter offline table mydb0.parent rename mydb1.parent;

show create table child;

alter online table mydb1.parent rename mydb0.parent;

show create table child;

use test;
alter offline table mydb1.child add constraint fk2 foreign key (b)
  references mydb0.parent(a);
use mydb1;
show create table child;

use test;
alter online table mydb1.child add constraint fk3 foreign key (c)
  references mydb0.parent(a);
use mydb1;
show create table child;

use test;
drop database mydb0;
drop database mydb1;
